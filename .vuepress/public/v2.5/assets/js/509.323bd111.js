(window.webpackJsonp=window.webpackJsonp||[]).push([[509],{605:function(e,t,s){"use strict";s.r(t);var a=s(0),n=Object(a.a)({},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"content"},[e._m(0),e._v(" "),s("p",[e._v("openHAB can store data over time; this is known as persistence.\nThe data may be retrieved at a later time, for example to restore your system after startup, or to prepare graphs for display on a UI.")]),e._v(" "),s("p",[e._v("openHAB persists Item states in a database, and most popular databases are supported.\nYou may have more than one persistence add-on loaded, and each of these may be configured independently.")]),e._v(" "),s("p",[e._v("A complete list of supported persistence add-ons may be found in the "),s("router-link",{attrs:{to:"/addons/#persistence"}},[e._v("persistence")]),e._v(" section of the on-line openHAB documentation.")],1),e._v(" "),s("p",[e._v("Please refer to the "),s("router-link",{attrs:{to:"/addons/#persistence"}},[e._v("available persistence service add-on")]),e._v(" documentation for your selected persistence add-on for configuration instructions.")],1),e._v(" "),e._m(1),e._v(" "),s("p",[e._v("It is important to select a default persistence service.\nYou should do this even if you have only one persistence add-on installed.")]),e._v(" "),s("p",[e._v('To select a default persistence service, in paper UI, select Configuration and then System from the side menu.\nScroll down to "Persistence", and select your default service from the drop-down list.\nNote that you must first install a persistence add-on before you make this selection.\nBe sure to save your choice once you have selected your default service.')]),e._v(" "),e._m(2),e._v(" "),s("p",[e._v("The information below allows you to determine which Item states are persisted, when they are persisted, and where they are stored.")]),e._v(" "),e._m(3),e._v(" "),e._m(4),e._v(" "),s("p",[e._v("The persistence of an Item's state may be triggered when that Item changes state or when the Item is updated (even if its state did not change).\nPersistence may also be triggered by a time-related event (see Cron Persistence Triggers below).")]),e._v(" "),e._m(5),e._v(" "),e._m(6),e._v(" "),e._m(7),e._m(8),e._v(" "),e._m(9),e._v(" "),e._m(10),e._v(" "),e._m(11),e._v(" "),e._m(12),e._v(" "),s("p",[e._v("openHAB uses "),s("a",{attrs:{href:"http://www.quartz-scheduler.org/documentation/quartz-2.1.x/quick-start.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("Quartz"),s("OutboundLink")],1),e._v(" for time-related cron events.\nSee the "),s("router-link",{attrs:{to:"/docs/configuration/rules-dsl.html#time-based-triggers"}},[e._v("Rules article")]),e._v(" for more information.")],1),e._v(" "),e._m(13),e._v(" "),s("p",[e._v("This section defines which items should be persisted with which strategy.\nThe syntax is as follows:")]),e._v(" "),e._m(14),e._m(15),e._v(" "),e._m(16),e._v(" "),e._m(17),e._v(" "),e._m(18),s("p",[e._v("then the following section,")]),e._v(" "),e._m(19),e._m(20),e._v(" "),s("p",[e._v("Below you will find a complete example persistence configuration file:")]),e._v(" "),e._m(21),e._m(22),e._v(" "),e._m(23),e._v(" "),e._m(24),s("p",[e._v("It is usually not necessary to restore all Items since there is a good chance that they are no longer accurate (switches may have been toggled, sensor values are likely to have changed), and the restoration may result in unwanted rule actions.")]),e._v(" "),e._m(25),e._v(" "),s("p",[e._v("To make use of persisted states inside scripts and rules, a few useful extensions have been defined on items.\nNote that these extensions are only available to be applied to Items.\nThey are not generally available for use in Scripts or Rules.")]),e._v(" "),s("p",[e._v("Example:")]),e._v(" "),s("p",[e._v("The statement")]),e._v(" "),e._m(26),e._v(" "),s("p",[e._v('will return the state of the Item "Temperature" from 24 hours ago.\nYou can easily imagine that you can implement very powerful rules using this feature.')]),e._v(" "),s("p",[e._v("Here is the full list of available persistence extensions:")]),e._v(" "),e._m(27),e._v(" "),s("p",[e._v("These extensions use the default persistence service.\n(Refer to 'Default Persistence Service' above to configure this.)\nYou may specify a different persistence service by appending a String as an optional additional parameter at the end of the extension.")]),e._v(" "),e._m(28),e._v(" "),e._m(29),e._v(" "),e._m(30),e._v(" "),s("p",[e._v("A number of date and time calculations have been made available in openHAB through incorporation of "),s("a",{attrs:{href:"http://joda-time.sourceforge.net/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Jodatime"),s("OutboundLink")],1),e._v(".\nThis makes it very easy to perform actions based upon time.\nHere are some examples:")]),e._v(" "),e._m(31),s("p",[e._v('The "now" variable can be used for relative time expressions, while "parse()" can define absolute dates and times.\nSee the '),s("a",{attrs:{href:"http://joda-time.sourceforge.net/api-release/org/joda/time/format/ISODateTimeFormat.html#dateTimeParser()",target:"_blank",rel:"noopener noreferrer"}},[e._v("Jodatime documentation"),s("OutboundLink")],1),e._v(" for information on accepted formats for string parsing.")]),e._v(" "),e._m(32),e._v(" "),s("p",[e._v('Persistence services and the Rule engine are started in parallel.\nBecause of this, it is possible that, during an openHAB startup, Rules will execute before Item states used by those Rules have been restored.\n(In this case, those unrestored Items have an "undefined" state when the Rule is executed.)\nTherefore, Rules that rely on persisted Item states may not work correctly on a consistent basis.')]),e._v(" "),e._m(33),e._v(" "),s("p",[e._v('A workaround which helps in some cases is to create an Item e.g. "delayed_start" that is set to "OFF" at startup and to "ON" some time later (when it can be assumed that persistence has restored all items).\nYou can then write a Rule that restores Items from your persistence service after the delay has completed.\nThe time of the delay must be determined by experimentation.\nHow long you need to wait before changing your "delayed_start" Item from "OFF" to "ON" depends upon the size of your home automation project and the performance of your platform.')]),e._v(" "),e._m(34),e._v(" "),e._m(35),e._v(" "),e._m(36),e._m(37),e._v(" "),e._m(38),e._m(39),e._v(" "),s("DocPreviousVersions"),e._v(" "),s("EditPageLink")],1)},[function(){var e=this.$createElement,t=this._self._c||e;return t("h1",{attrs:{id:"persistence"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#persistence","aria-hidden":"true"}},[this._v("#")]),this._v(" Persistence")])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"default-persistence-service"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#default-persistence-service","aria-hidden":"true"}},[this._v("#")]),this._v(" Default Persistence Service")])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"persistence-configuration"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#persistence-configuration","aria-hidden":"true"}},[this._v("#")]),this._v(" Persistence Configuration")])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("Persistence Strategies are configured in a file named "),t("code",[this._v("<persistenceservice>.persist")]),this._v(", stored in "),t("code",[this._v("$OPENHAB_CONF/persistence")]),this._v('.\nReplace "persistenceservice" with the name of your persistence add-on (e.g. '),t("code",[this._v("rrd4j.persist")]),this._v(").")])},function(){var e=this.$createElement,t=this._self._c||e;return t("h3",{attrs:{id:"persistence-triggers"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#persistence-triggers","aria-hidden":"true"}},[this._v("#")]),this._v(" Persistence Triggers")])},function(){var e=this.$createElement,t=this._self._c||e;return t("h3",{attrs:{id:"strategies"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#strategies","aria-hidden":"true"}},[this._v("#")]),this._v(" Strategies")])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("This section allows you to name and define one or more "),t("code",[this._v("Strategies")]),this._v(" and to select a default strategy.\nThe syntax is as follows:")])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("Strategies")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("<")]),e._v("strategyName1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(">")])]),e._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"cronexpression1"')]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("<")]),e._v("strategyName2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(">")])]),e._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"cronexpression2"')]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("default")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" everyChange\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("p",[e._v("The "),s("code",[e._v("default")]),e._v(" parameter assigns a strategy to be used if one is not specified in the "),s("code",[e._v("Items")]),e._v(" section below.\nThe "),s("code",[e._v("default")]),e._v(" parameter may be omitted from the "),s("code",[e._v("Strategies")]),e._v(" section, but only if a strategy is provided in each line of the "),s("code",[e._v("Items")]),e._v(" section.\nIf the "),s("code",[e._v("strategy")]),e._v(" portion of the "),s("code",[e._v("itemlist")]),e._v(" is omitted in the "),s("code",[e._v("Items")]),e._v(" section, the "),s("code",[e._v("default")]),e._v(" strategy specified in the "),s("code",[e._v("Strategies")]),e._v(" section will be applied.")])},function(){var e=this.$createElement,t=this._self._c||e;return t("h4",{attrs:{id:"predefined-strategies"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#predefined-strategies","aria-hidden":"true"}},[this._v("#")]),this._v(" Predefined Strategies")])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("The following strategies are defined internally and may be used in place of "),t("code",[this._v("strategyName")]),this._v(" above:")])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ul",[s("li",[s("code",[e._v("everyChange")]),e._v(": persist the Item state whenever its state has changed")]),e._v(" "),s("li",[s("code",[e._v("everyUpdate")]),e._v(": persist the Item state whenever its state has been updated, even if it did not change")]),e._v(" "),s("li",[s("code",[e._v("restoreOnStartup")]),e._v(": load and initialize the last persisted state of the Item on openHAB startup (if the Item state is undefined ("),s("code",[e._v("UNDEF")]),e._v(")).")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h4",{attrs:{id:"cron-persistence-triggers"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#cron-persistence-triggers","aria-hidden":"true"}},[this._v("#")]),this._v(" Cron Persistence Triggers")])},function(){var e=this.$createElement,t=this._self._c||e;return t("h3",{attrs:{id:"items"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#items","aria-hidden":"true"}},[this._v("#")]),this._v(" Items")])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("Items")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("<")]),e._v("itemlist1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(">")])]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("->")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"<alias1>"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("strategy "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("<")]),e._v("strategy1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(">")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("<")]),e._v("strategy2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(">")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("<")]),e._v("itemlist2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(">")])]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("->")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"<alias2>"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("strategy "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("<")]),e._v("strategyX"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(">")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("<")]),e._v("strategyY"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(">")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("where "),t("code",[this._v("<itemlist>")]),this._v(" is a comma-separated list consisting of one or more of the following options:")])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ul",[s("li",[s("code",[e._v("*")]),e._v(" - this line should apply to all items in the system")]),e._v(" "),s("li",[s("code",[e._v("<itemName>")]),e._v(" a single Item identified by its name. This Item can be a group Item.  But note that only the group value will be persisted.  The value of the individual group members will not be persisted using this option.")]),e._v(" "),s("li",[s("code",[e._v("<groupName>*")]),e._v(" - all members of this group will be persisted, but not the group itself. If no strategies are provided, the default strategies that are declared in the first section are applied.  Optionally, an alias may be provided if the persistence service requires special names (e.g. a table to be used in a database, a feed id for an IoT service, etc.)\nNote that * is NOT a wildcard match character in this context.")])])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("p",[e._v("The example "),s("code",[e._v("Items")]),e._v(" section below takes advantage of a "),s("code",[e._v("default")]),e._v(" entry in the  "),s("code",[e._v("Strategies")]),e._v(" section.\nAssume the "),s("code",[e._v("Strategies")]),e._v(" section contains the line:")])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[this._v("  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[this._v("default")]),this._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[this._v("=")]),this._v(" everyChange\n")])])])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("Items")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("GF_Hall_Light")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("will cause the state of "),t("code",[this._v("GF_Hall_Light")]),this._v(" to be persisted on every change.")])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-dsl"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[e._v('// persistence strategies have a name and definition and are referred to in the "Items" section')]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("Strategies")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n        everyHour "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"0 0 * * * ?"')]),e._v("\n        everyDay  "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"0 0 0 * * ?"')]),e._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// if no strategy is specified for an Item entry below, the default list will be used")]),e._v("\n       default "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" everyChange\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v('/*\n * Each line in this section defines for which Item(s) which strategy(ies) should be applied.\n * You can list single items, use "*" for all items or "groupitem*" for all members of a group\n * Item (excl. the group Item itself).\n */')]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("Items")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// persist the Item state of Heating_Mode and Notifications_Active on every change and restore them from the db at startup")]),e._v("\n        Heating_Mode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" Notifications_Active"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" strategy "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" everyChange"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" restoreOnStartup\n\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// additionally, persist all temperature and weather values every hour")]),e._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("Temperature")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" Weather"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" strategy "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" everyHour\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"restoring-item-states-on-restart"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#restoring-item-states-on-restart","aria-hidden":"true"}},[this._v("#")]),this._v(" Restoring Item States on Restart")])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("When restarting your openHAB installation you may find there are times when your logs indicate some Items have the state "),t("code",[this._v("NULL")]),this._v(".\nThis is because, by default, Item states are not persisted when openHAB restarts - even if you have installed a persistence add-on.\nIn order for items to be persisted across openHAB restarts, you must define a "),t("code",[this._v("restoreOnStartup")]),this._v(" strategy for your items.\nThen whatever state they were in before the restart will be restored automatically.\nThe following example persists two items on every change and restores them at startup:")])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("Strategies")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("default")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" everyUpdate\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("Items")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  item1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" item2 "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" strategy "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" everyChange"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" restoreOnStartup\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"persistence-extensions-in-scripts-and-rules"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#persistence-extensions-in-scripts-and-rules","aria-hidden":"true"}},[this._v("#")]),this._v(" Persistence Extensions in Scripts and Rules")])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[t("code",[this._v("Temperature.historicState(now.minusDays(1))")])])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("table",[s("thead",[s("tr",[s("th",[e._v("Persistence Extension")]),e._v(" "),s("th",[e._v("Description")])])]),e._v(" "),s("tbody",[s("tr",[s("td",[s("code",[e._v("<item>.persist")])]),e._v(" "),s("td",[e._v("Persists the current State of the Item")])]),e._v(" "),s("tr",[s("td",[s("code",[e._v("<item>.lastUpdate")])]),e._v(" "),s("td",[e._v("Queries for the last update timestamp of a given Item")])]),e._v(" "),s("tr",[s("td",[s("code",[e._v("<item>.historicState(AbstractInstant)")])]),e._v(" "),s("td",[e._v("Retrieves the State of an Item at a certain point in time (returns HistoricItem)")])]),e._v(" "),s("tr",[s("td",[s("code",[e._v("<item>.changedSince(AbstractInstant)")])]),e._v(" "),s("td",[e._v("Checks if the State of the Item has (ever) changed since a certain point in time")])]),e._v(" "),s("tr",[s("td",[s("code",[e._v("<item>.updatedSince(AbstractInstant)")])]),e._v(" "),s("td",[e._v("Checks if the state of the Item has been updated since a certain point in time")])]),e._v(" "),s("tr",[s("td",[s("code",[e._v("<item>.maximumSince(AbstractInstant)")])]),e._v(" "),s("td",[e._v("Gets the maximum value of the State of a persisted Item since a certain point in time")])]),e._v(" "),s("tr",[s("td",[s("code",[e._v("<item>.minimumSince(AbstractInstant)")])]),e._v(" "),s("td",[e._v("Gets the minimum value of the State of a persisted Item since a certain point in time")])]),e._v(" "),s("tr",[s("td",[s("code",[e._v("<item>.averageSince(AbstractInstant)")])]),e._v(" "),s("td",[e._v("Gets the average value of the State of a persisted Item since a certain point in time")])]),e._v(" "),s("tr",[s("td",[s("code",[e._v("<item>.deltaSince(AbstractInstant)")])]),e._v(" "),s("td",[e._v("Gets the difference in value of the State of a given Item since a certain point in time")])]),e._v(" "),s("tr",[s("td",[s("code",[e._v("<item>.previousState()")])]),e._v(" "),s("td",[e._v("Gets the previous State of a persisted Item (returns HistoricItem)")])]),e._v(" "),s("tr",[s("td",[s("code",[e._v("<item>.previousState(true)")])]),e._v(" "),s("td",[e._v("Gets the previous State of a persisted Item, skips Items with equal State values and searches the first Item with State not equal the current State (returns HistoricItem)")])]),e._v(" "),s("tr",[s("td",[s("code",[e._v("<item>.sumSince(AbstractInstant)")])]),e._v(" "),s("td",[e._v("Gets the sum of the previous States of a persisted Item since a certain point in time")])])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[t("strong",[this._v("Example")]),this._v("\nTo persist an Item called "),t("code",[this._v("Lights")]),this._v(" in an rrd4j database, you would enter the following:\n"),t("code",[this._v('Lights.persist("rrd4j")')])])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("The most useful methods of the HistoricItem object returned by some queries, are "),t("code",[this._v(".state")]),this._v(" and "),t("code",[this._v(".getTimestamp")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h3",{attrs:{id:"date-and-time-extensions"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#date-and-time-extensions","aria-hidden":"true"}},[this._v("#")]),this._v(" Date and Time Extensions")])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("Lights")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("changedSince")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("now"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("minusMinutes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("minusSeconds")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("30")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("Temperature")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("maximumSince")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("now"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("toDateMidnight"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("Temperature")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("minimumSince")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("parse")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"2012-01-01"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("PowerMeter")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("historicState")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("now"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("toDateMidnight"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("withDayOfMonth")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"startup-behavior"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#startup-behavior","aria-hidden":"true"}},[this._v("#")]),this._v(" Startup Behavior")])},function(){var e=this.$createElement,t=this._self._c||e;return t("h3",{attrs:{id:"workaround-1"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#workaround-1","aria-hidden":"true"}},[this._v("#")]),this._v(" Workaround 1")])},function(){var e=this.$createElement,t=this._self._c||e;return t("h3",{attrs:{id:"workaround-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#workaround-2","aria-hidden":"true"}},[this._v("#")]),this._v(" Workaround 2")])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("Create "),t("code",[this._v("$OPENHAB_CONF/rules/refresh.rules")]),this._v(" with the following content (This rule runs only once when openHAB starts):")])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-rules"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("var")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[e._v("boolean")]),e._v(" reloadOnce "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[e._v("true")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("rule")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"Refresh rules after persistence service has started"')]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("when")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("System started")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("then")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("if")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("reloadOnce"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("executeCommandLine")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"$OPENHAB_CONF/rules/rules_refresh.sh"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("else")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"reloadOnce is false"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n  reloadOnce "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[e._v("false")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("end")]),e._v("\n")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("Create a refresh script "),t("code",[this._v("$OPENHAB_CONF/rules/rules_refresh.sh")]),this._v(" and make it executable ("),t("code",[this._v("chmod +x $OPENHAB_CONF/rules/rules_refresh.sh")]),this._v("):")])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token shebang important"}},[e._v("#!/bin/bash")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("#This script is called by openHAB after the persistence service has started")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("sleep")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("5")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("find")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$OPENHAB_CONF")]),e._v('/rules"')]),e._v(" -type f -name "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'*.rules'")]),e._v(" -not -name refresh.rules "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("xargs")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("touch")]),e._v("\n")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("The script waits for five seconds and then touches all "),t("code",[this._v("*.rules")]),this._v(" files (except "),t("code",[this._v("refresh.rules")]),this._v(").\nThis causes openHAB to reload all rules (openHAB automatically reloads rules when their creation date/time changes).\nOther rules files may be added on new lines.\nNote - you will have to experiment to find the appropriate sleep value for your specific system.")])}],!1,null,null,null);t.default=n.exports}}]);