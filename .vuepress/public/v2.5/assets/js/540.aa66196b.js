(window.webpackJsonp=window.webpackJsonp||[]).push([[540],{495:function(t,e,s){"use strict";s.r(e);var a=s(0),n=Object(a.a)({},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"content"},[t._m(0),t._v(" "),s("p",[t._v("Find a few framework utilities listed in this chapter.")]),t._v(" "),t._m(1),t._v(" "),t._m(2),t._v(" "),s("p",[t._v("The id is provided through a static method and can be retrieved through")]),t._v(" "),t._m(3),t._m(4),t._v(" "),t._m(5),t._v(" "),t._m(6),t._v(" "),t._m(7),t._v(" "),t._m(8),t._v(" "),s("p",[t._v('Please be aware that not all network interface changes are notified to the listeners, only "useful" network interfaces :--\nWhen a network interface status changes from "up" to "down", it is considered as "removed".\nWhen a "loopback" or "down" interface is added, the listeners are not notified.')]),t._v(" "),t._m(9),t._v(" "),s("p",[t._v("The framework provides some caching solutions for common scenarios.")]),t._v(" "),t._m(10),t._v(" "),t._m(11),t._v(" "),t._m(12),t._v(" "),t._m(13),t._v(" "),t._m(14),t._v(" "),t._m(15),t._v(" "),t._m(16),t._m(17),t._v(" "),t._m(18),t._v(" "),t._m(19),t._v(" "),t._m(20),s("p",[t._v("If you deal with a newer implementation with a CompletableFuture support, it is even easier.\nYou would just return your CompletableFuture.")]),t._v(" "),s("DocPreviousVersions"),t._v(" "),s("EditPageLink")],1)},[function(){var t=this.$createElement,e=this._self._c||t;return e("h1",{attrs:{id:"framework-tools"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#framework-tools","aria-hidden":"true"}},[this._v("#")]),this._v(" Framework Tools")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h1",{attrs:{id:"unique-instance-id"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#unique-instance-id","aria-hidden":"true"}},[this._v("#")]),this._v(" Unique Instance ID")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("When communicating with external systems, it is often desirable to have a unique identifier.\nThe "),e("code",[this._v("org.eclipse.smarthome.core.id")]),this._v(" bundle is a mean to generate such an id, which is automatically persisted.\nThe persistence is done in the configured "),e("code",[this._v("userdata")]),this._v(" directory as a file called "),e("code",[this._v("uuid")]),this._v(".")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[t._v("    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" uuid "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("InstanceUUID")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h1",{attrs:{id:"network-address-service"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#network-address-service","aria-hidden":"true"}},[this._v("#")]),this._v(" Network Address Service")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[t._v("The "),s("code",[t._v("NetworkAddressService")]),t._v(" is an OSGi service that can be used like any other OSGi service by adding a service reference to it.\nIts OSGi service name is "),s("code",[t._v("org.eclipse.smarthome.network")]),t._v(".\nA user can configure his default network address via Paper UI under "),s("code",[t._v("Configuration -> System -> Network Settings")]),t._v(".\nOne can obtain the configured address via the "),s("code",[t._v("getPrimaryIpv4HostAddress()")]),t._v(" method on the service.\nThis service is useful for example in the "),s("code",[t._v("ThingHandlerFactory")]),t._v(" or an "),s("code",[t._v("AudioSink")]),t._v(" where one needs a specific IP address of the host system to provide something like a "),s("code",[t._v("callback")]),t._v(" URL.")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("Some static methods like "),e("code",[this._v("getAllBroadcastAddresses()")]),this._v(" for retrieving all interface broadcast addresses or "),e("code",[this._v("getInterfaceAddresses()")]),this._v(" for retrieving all assigned interface addresses might be usefull as well for discovery services.")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"network-address-change-listener"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#network-address-change-listener","aria-hidden":"true"}},[this._v("#")]),this._v(" Network Address Change Listener")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("The "),e("code",[this._v("NetworkAddressChangeListener")]),this._v(" is a consumer type OSGi service interface.\nIf listeners want to be notified about network interface address changes, they can implement "),e("code",[this._v("NetworkAddressChangeListener")]),this._v(" and register as an OSGi service.")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h1",{attrs:{id:"caching"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#caching","aria-hidden":"true"}},[this._v("#")]),this._v(" Caching")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[t._v("A common usage case is in a "),s("code",[t._v("ThingHandler")]),t._v(" to encapsulate one value of an internal state and attach an expire time on that value.\nA cache action will be called to refresh the value if it is expired.\nThis is what "),s("code",[t._v("ExpiringCache")]),t._v(" implements.\nIf "),s("code",[t._v("handleCommand(ChannelUID channelUID, Command command)")]),t._v(' is called with the "RefreshType" command, you just return '),s("code",[t._v("cache.getValue()")]),t._v(".")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("It is a good practice to return as fast as possible from the "),e("code",[this._v("handleCommand(ChannelUID channelUID, Command command)")]),this._v(" method to not block callers especially UIs.\nUse this type of cache only, if your refresh action is a quick to compute, blocking operation.\nIf you deal with network calls, consider the asynchronously reloading cache implementation instead.")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"expiring-and-asynchronously-reloading-cache"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#expiring-and-asynchronously-reloading-cache","aria-hidden":"true"}},[this._v("#")]),this._v(" Expiring and asynchronously reloading cache")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("If we refreshed a value of the internal state in a "),e("code",[this._v("ThingHandler")]),this._v(" just recently, we can return it immediately via the usual "),e("code",[this._v("updateState(channel, state)")]),this._v(' method in response to a "RefreshType" command.\nIf the state is too old, we need to fetch it first and this may involve network calls, interprocess operations or anything else that will would block for a considerable amout of time.')])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("A common usage case of the "),e("code",[this._v("ExpiringCacheAsync")]),this._v(" cache type is in a "),e("code",[this._v("ThingHandler")]),this._v(" to encapsulate one value of an internal state and attach an expire time on that value.")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("A "),e("strong",[this._v("handleCommand")]),this._v(" implementation with the interesting "),e("em",[this._v("RefreshType")]),this._v(" could look like this:")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("handleCommand")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ChannelUID")]),t._v(" channelUID"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Command")]),t._v(" command"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("command "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("instanceof")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RefreshType")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("switch")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("channelUID"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" CHANNEL_1"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n                cache1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getValue")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("updater"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("thenAccept")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("value "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("updateState")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("CHANNEL_1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" value"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("break")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("The interesting part is the "),e("code",[this._v("updater")]),this._v(".\nIf the value is not yet expired, the returned CompletableFuture will complete immediately and the given code is executed.\nIf the value is expired, the updater will be used to request a refreshed value.")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("An updater can be any class or lambda that implements the funtional interface of "),e("code",[this._v("Supplier<CompletableFuture<VALUE_TYPE>>")]),this._v(".")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[t._v("In the following example the method "),s("code",[t._v("CompletableFuture<VALUE_TYPE> get()")]),t._v(" is accordingly implemented.\nThe example assumes that we deal\nwith a still very common callback based device refreshing method "),s("code",[t._v("doSuperImportantAsyncStuffHereToGetRefreshedValue(listener)")]),t._v(".\nThe listener is the class\nitself, which implements "),s("code",[t._v("DeviceStateUpdateListener")]),t._v(".\nWe will be called back with a refreshed device state in "),s("code",[t._v("asyncCallbackFromDeviceStateRefresh")]),t._v("\nand mark the Future as "),s("em",[t._v("complete")]),t._v(".")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("FetchValueFromDevice")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("implements")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Supplier")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CompletableFuture")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("double")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("DeviceStateUpdateListener")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CompletableFuture")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("double")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" c"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CompletableFuture")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("double")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n       "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("c "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          c "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CompletableFuture")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("double")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("doSuperImportantAsyncStuffHereToGetRefreshedValue")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("DeviceStateUpdateListener")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n       "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n       "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" c"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    \n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Here you process the callback from your device refresh method")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("asyncCallbackFromDeviceStateRefresh")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("double")]),t._v(" newValue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n       "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Notify the future that we have something")]),t._v("\n       "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("c "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          c"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("complete")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("newValue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n          c "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n       "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])}],!1,null,null,null);e.default=n.exports}}]);